WITH
 e AS (
    SELECT top 1
      itbisenprecio,
      trim(rnc)   as rnc ,
	  ambiente,
	  nota
    FROM empresa WITH (NOLOCK)
  ), 
 AmbienteInfo AS ( Select top 1
        A.AMBIENTE   as AMBIENTE, 
        A.DESCRIP   as DESCRIP, 
        ISNULL(A.RUTA, '')  AS RUTA 
    FROM FEAmbiente A WITH (NOLOCK)
	LEFT JOIN e WITH (NOLOCK) on  a.ambiente = e.ambiente 
    WHERE A.RUTA IS NOT NULL
	and a.ambiente = e.ambiente
)
SELECT
  dbo.FEEncabezado.TipoECF,
  dbo.FEEncabezado.eNCF,
  'feencabezado' as Tabla,
  'rncemisor' as campo1,
  'encf' as campo2,
  dbo.FEEncabezado.FechaVencimientoSecuencia,
  dbo.FEEncabezado.IndicadorNotaCredito,
  dbo.FEEncabezado.IndicadorEnvioDiferido,
  dbo.FEEncabezado.IndicadorMontoGravado,
  dbo.FEEncabezado.TipoIngresos,
  dbo.FEEncabezado.TipoPago,
  dbo.FEEncabezado.FechaLimitePago,
  dbo.FEEncabezado.TerminoPago,
  dbo.FEEncabezado.FormaPago1,
  dbo.FEEncabezado.MontoPago1,
  dbo.FEEncabezado.FormaPago2,
  dbo.FEEncabezado.MontoPago2,
  dbo.FEEncabezado.FormaPago3,
  dbo.FEEncabezado.MontoPago3,
  dbo.FEEncabezado.FormaPago4,
  dbo.FEEncabezado.MontoPago4,
  dbo.FEEncabezado.FormaPago5,
  dbo.FEEncabezado.MontoPago5,
  dbo.FEEncabezado.FormaPago6,
  dbo.FEEncabezado.MontoPago6,
  dbo.FEEncabezado.FormaPago7,
  dbo.FEEncabezado.MontoPago7,
  dbo.FEEncabezado.TipoCuentaPago,
  dbo.FEEncabezado.NumeroCuentaPago,
  dbo.FEEncabezado.BancoPago,
  dbo.FEEncabezado.FechaDesde,
  dbo.FEEncabezado.FechaHasta,
  dbo.FEEncabezado.TotalPaginas,
  dbo.FEEncabezado.RNCEmisor,
  dbo.FEEncabezado.RazonSocialEmisor,
  dbo.FEEncabezado.NombreComercial,
  dbo.FEEncabezado.Sucursal,
  dbo.FEEncabezado.DireccionEmisor,
  dbo.FEEncabezado.Municipio,
  dbo.FEEncabezado.Provincia,
  dbo.FEEncabezado.TelefonoEmisor1,
  dbo.FEEncabezado.TelefonoEmisor2,
  dbo.FEEncabezado.TelefonoEmisor3,
  dbo.FEEncabezado.CorreoEmisor,
  dbo.FEEncabezado.WebSite,
  dbo.FEEncabezado.ActividadEconomica,
  dbo.FEEncabezado.CodigoVendedor,
  dbo.FEEncabezado.NumeroFacturaInterna,
  dbo.FEEncabezado.NumeroPedidoInterno,
  dbo.FEEncabezado.ZonaVenta,
  dbo.FEEncabezado.RutaVenta,
  dbo.FEEncabezado.InformacionAdicionalEmisor,
  dbo.FEEncabezado.FechaEmision,
  dbo.FEEncabezado.RNCComprador,
  dbo.FEEncabezado.IdentificadorExtranjero,
  dbo.FEEncabezado.RazonSocialComprador,
  dbo.FEEncabezado.ContactoComprador,
  dbo.FEEncabezado.CorreoComprador,
  dbo.FEEncabezado.DireccionComprador,
  dbo.FEEncabezado.MunicipioComprador,
  dbo.FEEncabezado.ProvinciaComprador,
  dbo.FEEncabezado.PaisComprador,
  dbo.FEEncabezado.FechaEntrega,
  dbo.FEEncabezado.ContactoEntrega,
  dbo.FEEncabezado.DireccionEntrega,
  dbo.FEEncabezado.TelefonoAdicional,
  dbo.FEEncabezado.FechaOrdenCompra,
  dbo.FEEncabezado.NumeroOrdenCompra,
  dbo.FEEncabezado.CodigoInternoComprador,
  dbo.FEEncabezado.ResponsablePago,
  dbo.FEEncabezado.Informacionadicionalcomprador,
  dbo.FEEncabezado.FechaEmbarque,
  dbo.FEEncabezado.NumeroEmbarque,
  dbo.FEEncabezado.NumeroContenedor,
  dbo.FEEncabezado.NumeroReferencia,
  dbo.FEEncabezado.NombrePuertoEmbarque,
  dbo.FEEncabezado.CondicionesEntrega,
  dbo.FEEncabezado.TotalFob,
  dbo.FEEncabezado.Seguro,
  dbo.FEEncabezado.Flete,
  dbo.FEEncabezado.OtrosGastos,
  dbo.FEEncabezado.TotalCif,
  dbo.FEEncabezado.RegimenAduanero,
  dbo.FEEncabezado.NombrePuertoSalida,
  dbo.FEEncabezado.NombrePuertoDesembarque,
  dbo.FEEncabezado.PesoBruto,
  dbo.FEEncabezado.PesoNeto,
  dbo.FEEncabezado.UnidadPesoBruto,
  dbo.FEEncabezado.UnidadPesoNeto,
  dbo.FEEncabezado.CantidadBulto,
  dbo.FEEncabezado.UnidadBulto,
  dbo.FEEncabezado.VolumenBulto,
  dbo.FEEncabezado.UnidadVolumen,
  dbo.FEEncabezado.ViaTransporte,
  dbo.FEEncabezado.PaisOrigen,
  dbo.FEEncabezado.DireccionDestino,
  dbo.FEEncabezado.PaisDestino,
  dbo.FEEncabezado.RNCIdentificacionCompaniaTransportista,
  dbo.FEEncabezado.NombreCompaniaTransportista,
  dbo.FEEncabezado.NumeroViaje,
  dbo.FEEncabezado.Conductor,
  dbo.FEEncabezado.DocumentoTransporte,
  dbo.FEEncabezado.Ficha,
  dbo.FEEncabezado.Placa,
  dbo.FEEncabezado.RutaTransporte,
  dbo.FEEncabezado.ZonaTransporte,
  dbo.FEEncabezado.NumeroAlbaran,
  dbo.FEEncabezado.MontoGravadoTotal,
  dbo.FEEncabezado.MontoGravadoI1,
  dbo.FEEncabezado.MontoGravadoI2,
  dbo.FEEncabezado.MontoGravadoI3,
  dbo.FEEncabezado.MontoExento,
  dbo.FEEncabezado.ITBIS1,
  dbo.FEEncabezado.ITBIS2,
  dbo.FEEncabezado.ITBIS3,
  dbo.FEEncabezado.TotalITBIS,
  dbo.FEEncabezado.TotalITBIS1,
  dbo.FEEncabezado.TotalITBIS2,
  dbo.FEEncabezado.TotalITBIS3,
  dbo.FEEncabezado.MontoImpuestoAdicional,
  dbo.FEEncabezado.TipoImpuesto1,
  dbo.FEEncabezado.TasaImpuestoAdicional1,
  dbo.FEEncabezado.MontoImpuestoSelectivoConsumoEspecifico1,
  dbo.FEEncabezado.MontoImpuestoSelectivoConsumoAdvalorem1,
  dbo.FEEncabezado.OtrosImpuestosAdicionales1,
  dbo.FEEncabezado.TipoImpuesto2,
  dbo.FEEncabezado.TasaImpuestoAdicional2,
  dbo.FEEncabezado.MontoImpuestoSelectivoConsumoEspecifico2,
  dbo.FEEncabezado.MontoImpuestoSelectivoConsumoAdvalorem2,
  dbo.FEEncabezado.OtrosImpuestosAdicionales2,
  dbo.FEEncabezado.TipoImpuesto3,
  dbo.FEEncabezado.TasaImpuestoAdicional3,
  dbo.FEEncabezado.MontoImpuestoSelectivoConsumoEspecifico3,
  dbo.FEEncabezado.MontoImpuestoSelectivoConsumoAdvalorem3,
  dbo.FEEncabezado.OtrosImpuestosAdicionales3,
  dbo.FEEncabezado.TipoImpuesto4,
  dbo.FEEncabezado.TasaImpuestoAdicional4,
  dbo.FEEncabezado.MontoImpuestoSelectivoConsumoEspecifico4,
  dbo.FEEncabezado.MontoImpuestoSelectivoConsumoAdvalorem4,
  dbo.FEEncabezado.OtrosImpuestosAdicionales4,
  dbo.FEEncabezado.MontoTotal,
  dbo.FEEncabezado.MontoNoFacturable,
  dbo.FEEncabezado.MontoPeriodo,
  dbo.FEEncabezado.SaldoAnterior,
  dbo.FEEncabezado.MontoAvancePago,
  dbo.FEEncabezado.ValorPagar,
  dbo.FEEncabezado.TotalITBISRetenido,
  dbo.FEEncabezado.TotalISRRetencion,
  dbo.FEEncabezado.TotalITBISPercepcion,
  dbo.FEEncabezado.TotalISRPercepcion,
  dbo.FEEncabezado.TipoMoneda,
  dbo.FEEncabezado.TipoCambio,
  dbo.FEEncabezado.MontoGravadoTotalOtraMoneda,
  dbo.FEEncabezado.MontoGravado1OtraMoneda,
  dbo.FEEncabezado.MontoGravado2OtraMoneda,
  dbo.FEEncabezado.MontoGravado3OtraMoneda,
  dbo.FEEncabezado.MontoExentoOtraMoneda,
  dbo.FEEncabezado.TotalITBISOtraMoneda,
  dbo.FEEncabezado.TotalITBIS1OtraMoneda,
  dbo.FEEncabezado.TotalITBIS2OtraMoneda,
  dbo.FEEncabezado.TotalITBIS3OtraMoneda,
  dbo.FEEncabezado.MontoImpuestoAdicionalOtraMoneda,
  dbo.FEEncabezado.TipoImpuestoOtraMoneda1,
  dbo.FEEncabezado.TasaImpuestoAdicionalOtraMoneda1,
  dbo.FEEncabezado.MontoImpuestoSelectivoConsumoEspecificoOtraMoneda1,
  dbo.FEEncabezado.MontoImpuestoSelectivoConsumoAdvaloremOtraMoneda1,
  dbo.FEEncabezado.OtrosImpuestosAdicionalesOtraMoneda1,
  dbo.FEEncabezado.TipoImpuestoOtraMoneda2,
  dbo.FEEncabezado.TasaImpuestoAdicionalOtraMoneda2,
  dbo.FEEncabezado.MontoImpuestoSelectivoConsumoEspecificoOtraMoneda2,
  dbo.FEEncabezado.MontoImpuestoSelectivoConsumoAdvaloremOtraMoneda2,
  dbo.FEEncabezado.OtrosImpuestosAdicionalesOtraMoneda2,
  dbo.FEEncabezado.TipoImpuestoOtraMoneda3,
  dbo.FEEncabezado.TasaImpuestoAdicionalOtraMoneda3,
  dbo.FEEncabezado.MontoImpuestoSelectivoConsumoEspecificoOtraMoneda3,
  dbo.FEEncabezado.MontoImpuestoSelectivoConsumoAdvaloremOtraMoneda3,
  dbo.FEEncabezado.OtrosImpuestosAdicionalesOtraMoneda3,
  dbo.FEEncabezado.TipoImpuestoOtraMoneda4,
  dbo.FEEncabezado.TasaImpuestoAdicionalOtraMoneda4,
  dbo.FEEncabezado.MontoImpuestoSelectivoConsumoEspecificoOtraMoneda4,
  dbo.FEEncabezado.MontoImpuestoSelectivoConsumoAdvaloremOtraMoneda4,
  dbo.FEEncabezado.OtrosImpuestosAdicionalesOtraMoneda4,
  dbo.FEEncabezado.MontoTotalOtraMoneda,
  dbo.FEEncabezado.trackid,
  dbo.FEEncabezado.FechaFirma,
  dbo.FEEncabezado.CodigoSeguridad,
  dbo.FEEncabezado.CodigoSeguridadCF,
  dbo.FEEncabezado.EstadoFiscal,
  dbo.FEEncabezado.fechacreacion,
  dbo.FEEncabezado.EstadoImpresion,
  dbo.FEEncabezado.ConteoImpresiones,
  dbo.FEEncabezado.transferencia,
  dbo.FEEncabezado.Modificado,
  dbo.FEEncabezado.ResultadoEstadoFiscal,
  dbo.FEEncabezado.MontoDGII,
  dbo.FEEncabezado.MontoITBISDGII,
  dbo.FEEncabezado.TipoImpuesto5,
  dbo.FEEncabezado.TasaImpuestoAdicional5,
  dbo.FEEncabezado.MontoImpuestoSelectivoConsumoEspecifico5,
  dbo.FEEncabezado.MontoImpuestoSelectivoConsumoAdvalorem5,
  dbo.FEEncabezado.OtrosImpuestosAdicionales5,
  dbo.FEEncabezado.TipoImpuesto6,
  dbo.FEEncabezado.TasaImpuestoAdicional6,
  dbo.FEEncabezado.MontoImpuestoSelectivoConsumoEspecifico6,
  dbo.FEEncabezado.MontoImpuestoSelectivoConsumoAdvalorem6,
  dbo.FEEncabezado.OtrosImpuestosAdicionales6,
  dbo.FEEncabezado.TipoImpuesto7,
  dbo.FEEncabezado.TasaImpuestoAdicional7,
  dbo.FEEncabezado.MontoImpuestoSelectivoConsumoEspecifico7,
  dbo.FEEncabezado.MontoImpuestoSelectivoConsumoAdvalorem7,
  dbo.FEEncabezado.OtrosImpuestosAdicionales7,
  dbo.FEEncabezado.TipoImpuesto8,
  dbo.FEEncabezado.TasaImpuestoAdicional8,
  dbo.FEEncabezado.MontoImpuestoSelectivoConsumoEspecifico8,
  dbo.FEEncabezado.MontoImpuestoSelectivoConsumoAdvalorem8,
  dbo.FEEncabezado.OtrosImpuestosAdicionales8,
  dbo.FEEncabezado.TipoImpuesto9,
  dbo.FEEncabezado.TasaImpuestoAdicional9,
  dbo.FEEncabezado.MontoImpuestoSelectivoConsumoEspecifico9,
  dbo.FEEncabezado.MontoImpuestoSelectivoConsumoAdvalorem9,
  dbo.FEEncabezado.OtrosImpuestosAdicionales9,
  dbo.FEEncabezado.TipoImpuesto10,
  dbo.FEEncabezado.TasaImpuestoAdicional10,
  dbo.FEEncabezado.MontoImpuestoSelectivoConsumoEspecifico10,
  dbo.FEEncabezado.MontoImpuestoSelectivoConsumoAdvalorem10,
  dbo.FEEncabezado.OtrosImpuestosAdicionales10,
  dbo.FEEncabezado.TipoImpuesto11,
  dbo.FEEncabezado.TasaImpuestoAdicional11,
  dbo.FEEncabezado.MontoImpuestoSelectivoConsumoEspecifico11,
  dbo.FEEncabezado.MontoImpuestoSelectivoConsumoAdvalorem11,
  dbo.FEEncabezado.OtrosImpuestosAdicionales11,
  dbo.FEEncabezado.TipoImpuesto12,
  dbo.FEEncabezado.TasaImpuestoAdicional12,
  dbo.FEEncabezado.MontoImpuestoSelectivoConsumoEspecifico12,
  dbo.FEEncabezado.MontoImpuestoSelectivoConsumoAdvalorem12,
  dbo.FEEncabezado.OtrosImpuestosAdicionales12,
  dbo.FEEncabezado.TipoImpuesto13,
  dbo.FEEncabezado.TasaImpuestoAdicional13,
  dbo.FEEncabezado.MontoImpuestoSelectivoConsumoEspecifico13,
  dbo.FEEncabezado.MontoImpuestoSelectivoConsumoAdvalorem13,
  dbo.FEEncabezado.OtrosImpuestosAdicionales13,
  dbo.FEEncabezado.TipoImpuesto14,
  dbo.FEEncabezado.TasaImpuestoAdicional14,
  dbo.FEEncabezado.MontoImpuestoSelectivoConsumoEspecifico14,
  dbo.FEEncabezado.MontoImpuestoSelectivoConsumoAdvalorem14,
  dbo.FEEncabezado.OtrosImpuestosAdicionales14,
  dbo.FEEncabezado.TipoImpuesto15,
  dbo.FEEncabezado.TasaImpuestoAdicional15,
  dbo.FEEncabezado.MontoImpuestoSelectivoConsumoEspecifico15,
  dbo.FEEncabezado.MontoImpuestoSelectivoConsumoAdvalorem15,
  dbo.FEEncabezado.OtrosImpuestosAdicionales15,
  dbo.FEEncabezado.TipoImpuesto16,
  dbo.FEEncabezado.TasaImpuestoAdicional16,
  dbo.FEEncabezado.MontoImpuestoSelectivoConsumoEspecifico16,
  dbo.FEEncabezado.MontoImpuestoSelectivoConsumoAdvalorem16,
  dbo.FEEncabezado.OtrosImpuestosAdicionales16,
  dbo.FEEncabezado.TipoImpuesto17,
  dbo.FEEncabezado.TasaImpuestoAdicional17,
  dbo.FEEncabezado.MontoImpuestoSelectivoConsumoEspecifico17,
  dbo.FEEncabezado.MontoImpuestoSelectivoConsumoAdvalorem17,
  dbo.FEEncabezado.OtrosImpuestosAdicionales17,
  dbo.FEEncabezado.TipoImpuesto18,
  dbo.FEEncabezado.TasaImpuestoAdicional18,
  dbo.FEEncabezado.MontoImpuestoSelectivoConsumoEspecifico18,
  dbo.FEEncabezado.MontoImpuestoSelectivoConsumoAdvalorem18,
  dbo.FEEncabezado.OtrosImpuestosAdicionales18,
  dbo.FEEncabezado.TipoImpuesto19,
  dbo.FEEncabezado.TasaImpuestoAdicional19,
  dbo.FEEncabezado.MontoImpuestoSelectivoConsumoEspecifico19,
  dbo.FEEncabezado.MontoImpuestoSelectivoConsumoAdvalorem19,
  dbo.FEEncabezado.OtrosImpuestosAdicionales19,
  dbo.FEEncabezado.TipoImpuesto20,
  dbo.FEEncabezado.TasaImpuestoAdicional20,
  dbo.FEEncabezado.MontoImpuestoSelectivoConsumoEspecifico20,
  dbo.FEEncabezado.MontoImpuestoSelectivoConsumoAdvalorem20,
  dbo.FEEncabezado.OtrosImpuestosAdicionales20,
  dbo.FEEncabezado.NumeroLineaDoR1,
  dbo.FEEncabezado.TipoAjuste1,
  dbo.FEEncabezado.IndicadorNorma10071,
  dbo.FEEncabezado.DescripcionDescuentooRecargo1,
  dbo.FEEncabezado.TipoValor1,
  dbo.FEEncabezado.ValorDescuentooRecargo1,
  dbo.FEEncabezado.MontoDescuentooRecargo1,
  dbo.FEEncabezado.MontoDescuentooRecargoOtraMoneda1,
  dbo.FEEncabezado.IndicadorFacturacionDescuentooRecargo1,
  dbo.FEEncabezado.NumeroLineaDoR2,
  dbo.FEEncabezado.TipoAjuste2,
  dbo.FEEncabezado.IndicadorNorma10072,
  dbo.FEEncabezado.DescripcionDescuentooRecargo2,
  dbo.FEEncabezado.TipoValor2,
  dbo.FEEncabezado.ValorDescuentooRecargo2,
  dbo.FEEncabezado.MontoDescuentooRecargo2,
  dbo.FEEncabezado.MontoDescuentooRecargoOtraMoneda2,
  dbo.FEEncabezado.IndicadorFacturacionDescuentooRecargo2,
  dbo.FEEncabezado.NumeroLineaDoR3,
  dbo.FEEncabezado.TipoAjuste3,
  dbo.FEEncabezado.IndicadorNorma10073,
  dbo.FEEncabezado.DescripcionDescuentooRecargo3,
  dbo.FEEncabezado.TipoValor3,
  dbo.FEEncabezado.ValorDescuentooRecargo3,
  dbo.FEEncabezado.MontoDescuentooRecargo3,
  dbo.FEEncabezado.MontoDescuentooRecargoOtraMoneda3,
  dbo.FEEncabezado.IndicadorFacturacionDescuentooRecargo3,
  dbo.FEEncabezado.NumeroLineaDoR4,
  dbo.FEEncabezado.TipoAjuste4,
  dbo.FEEncabezado.IndicadorNorma10074,
  dbo.FEEncabezado.DescripcionDescuentooRecargo4,
  dbo.FEEncabezado.TipoValor4,
  dbo.FEEncabezado.ValorDescuentooRecargo4,
  dbo.FEEncabezado.MontoDescuentooRecargo4,
  dbo.FEEncabezado.MontoDescuentooRecargoOtraMoneda4,
  dbo.FEEncabezado.IndicadorFacturacionDescuentooRecargo4,
  dbo.FEEncabezado.NumeroLineaDoR5,
  dbo.FEEncabezado.TipoAjuste5,
  dbo.FEEncabezado.IndicadorNorma10075,
  dbo.FEEncabezado.DescripcionDescuentooRecargo5,
  dbo.FEEncabezado.TipoValor5,
  dbo.FEEncabezado.ValorDescuentooRecargo5,
  dbo.FEEncabezado.MontoDescuentooRecargo5,
  dbo.FEEncabezado.MontoDescuentooRecargoOtraMoneda5,
  dbo.FEEncabezado.IndicadorFacturacionDescuentooRecargo5,
  dbo.FEEncabezado.NumeroLineaDoR6,
  dbo.FEEncabezado.TipoAjuste6,
  dbo.FEEncabezado.IndicadorNorma10076,
  dbo.FEEncabezado.DescripcionDescuentooRecargo6,
  dbo.FEEncabezado.TipoValor6,
  dbo.FEEncabezado.ValorDescuentooRecargo6,
  dbo.FEEncabezado.MontoDescuentooRecargo6,
  dbo.FEEncabezado.MontoDescuentooRecargoOtraMoneda6,
  dbo.FEEncabezado.IndicadorFacturacionDescuentooRecargo6,
  dbo.FEEncabezado.NumeroLineaDoR7,
  dbo.FEEncabezado.TipoAjuste7,
  dbo.FEEncabezado.IndicadorNorma10077,
  dbo.FEEncabezado.DescripcionDescuentooRecargo7,
  dbo.FEEncabezado.TipoValor7,
  dbo.FEEncabezado.ValorDescuentooRecargo7,
  dbo.FEEncabezado.MontoDescuentooRecargo7,
  dbo.FEEncabezado.MontoDescuentooRecargoOtraMoneda7,
  dbo.FEEncabezado.IndicadorFacturacionDescuentooRecargo7,
  dbo.FEEncabezado.NumeroLineaDoR8,
  dbo.FEEncabezado.TipoAjuste8,
  dbo.FEEncabezado.IndicadorNorma10078,
  dbo.FEEncabezado.DescripcionDescuentooRecargo8,
  dbo.FEEncabezado.TipoValor8,
  dbo.FEEncabezado.ValorDescuentooRecargo8,
  dbo.FEEncabezado.MontoDescuentooRecargo8,
  dbo.FEEncabezado.MontoDescuentooRecargoOtraMoneda8,
  dbo.FEEncabezado.IndicadorFacturacionDescuentooRecargo8,
  dbo.FEEncabezado.NumeroLineaDoR9,
  dbo.FEEncabezado.TipoAjuste9,
  dbo.FEEncabezado.IndicadorNorma10079,
  dbo.FEEncabezado.DescripcionDescuentooRecargo9,
  dbo.FEEncabezado.TipoValor9,
  dbo.FEEncabezado.ValorDescuentooRecargo9,
  dbo.FEEncabezado.MontoDescuentooRecargo9,
  dbo.FEEncabezado.MontoDescuentooRecargoOtraMoneda9,
  dbo.FEEncabezado.IndicadorFacturacionDescuentooRecargo9,
  dbo.FEEncabezado.NumeroLineaDoR10,
  dbo.FEEncabezado.TipoAjuste10,
  dbo.FEEncabezado.IndicadorNorma100710,
  dbo.FEEncabezado.DescripcionDescuentooRecargo10,
  dbo.FEEncabezado.TipoValor10,
  dbo.FEEncabezado.ValorDescuentooRecargo10,
  dbo.FEEncabezado.MontoDescuentooRecargo10,
  dbo.FEEncabezado.MontoDescuentooRecargoOtraMoneda10,
  dbo.FEEncabezado.IndicadorFacturacionDescuentooRecargo10,
  dbo.FEEncabezado.NumeroLineaDoR11,
  dbo.FEEncabezado.TipoAjuste11,
  dbo.FEEncabezado.IndicadorNorma100711,
  dbo.FEEncabezado.DescripcionDescuentooRecargo11,
  dbo.FEEncabezado.TipoValor11,
  dbo.FEEncabezado.ValorDescuentooRecargo11,
  dbo.FEEncabezado.MontoDescuentooRecargo11,
  dbo.FEEncabezado.MontoDescuentooRecargoOtraMoneda11,
  dbo.FEEncabezado.IndicadorFacturacionDescuentooRecargo11,
  dbo.FEEncabezado.NumeroLineaDoR12,
  dbo.FEEncabezado.TipoAjuste12,
  dbo.FEEncabezado.IndicadorNorma100712,
  dbo.FEEncabezado.DescripcionDescuentooRecargo12,
  dbo.FEEncabezado.TipoValor12,
  dbo.FEEncabezado.ValorDescuentooRecargo12,
  dbo.FEEncabezado.MontoDescuentooRecargo12,
  dbo.FEEncabezado.MontoDescuentooRecargoOtraMoneda12,
  dbo.FEEncabezado.IndicadorFacturacionDescuentooRecargo12,
  dbo.FEEncabezado.NumeroLineaDoR13,
  dbo.FEEncabezado.TipoAjuste13,
  dbo.FEEncabezado.IndicadorNorma100713,
  dbo.FEEncabezado.DescripcionDescuentooRecargo13,
  dbo.FEEncabezado.TipoValor13,
  dbo.FEEncabezado.ValorDescuentooRecargo13,
  dbo.FEEncabezado.MontoDescuentooRecargo13,
  dbo.FEEncabezado.MontoDescuentooRecargoOtraMoneda13,
  dbo.FEEncabezado.IndicadorFacturacionDescuentooRecargo13,
  dbo.FEEncabezado.NumeroLineaDoR14,
  dbo.FEEncabezado.TipoAjuste14,
  dbo.FEEncabezado.IndicadorNorma100714,
  dbo.FEEncabezado.DescripcionDescuentooRecargo14,
  dbo.FEEncabezado.TipoValor14,
  dbo.FEEncabezado.ValorDescuentooRecargo14,
  dbo.FEEncabezado.MontoDescuentooRecargo14,
  dbo.FEEncabezado.MontoDescuentooRecargoOtraMoneda14,
  dbo.FEEncabezado.IndicadorFacturacionDescuentooRecargo14,
  dbo.FEEncabezado.NumeroLineaDoR15,
  dbo.FEEncabezado.TipoAjuste15,
  dbo.FEEncabezado.IndicadorNorma100715,
  dbo.FEEncabezado.DescripcionDescuentooRecargo15,
  dbo.FEEncabezado.TipoValor15,
  dbo.FEEncabezado.ValorDescuentooRecargo15,
  dbo.FEEncabezado.MontoDescuentooRecargo15,
  dbo.FEEncabezado.MontoDescuentooRecargoOtraMoneda15,
  dbo.FEEncabezado.IndicadorFacturacionDescuentooRecargo15,
  dbo.FEEncabezado.NumeroLineaDoR16,
  dbo.FEEncabezado.TipoAjuste16,
  dbo.FEEncabezado.IndicadorNorma100716,
  dbo.FEEncabezado.DescripcionDescuentooRecargo16,
  dbo.FEEncabezado.TipoValor16,
  dbo.FEEncabezado.ValorDescuentooRecargo16,
  dbo.FEEncabezado.MontoDescuentooRecargo16,
  dbo.FEEncabezado.MontoDescuentooRecargoOtraMoneda16,
  dbo.FEEncabezado.IndicadorFacturacionDescuentooRecargo16,
  dbo.FEEncabezado.NumeroLineaDoR17,
  dbo.FEEncabezado.TipoAjuste17,
  dbo.FEEncabezado.IndicadorNorma100717,
  dbo.FEEncabezado.DescripcionDescuentooRecargo17,
  dbo.FEEncabezado.TipoValor17,
  dbo.FEEncabezado.ValorDescuentooRecargo17,
  dbo.FEEncabezado.MontoDescuentooRecargo17,
  dbo.FEEncabezado.MontoDescuentooRecargoOtraMoneda17,
  dbo.FEEncabezado.IndicadorFacturacionDescuentooRecargo17,
  dbo.FEEncabezado.NumeroLineaDoR18,
  dbo.FEEncabezado.TipoAjuste18,
  dbo.FEEncabezado.IndicadorNorma100718,
  dbo.FEEncabezado.DescripcionDescuentooRecargo18,
  dbo.FEEncabezado.TipoValor18,
  dbo.FEEncabezado.ValorDescuentooRecargo18,
  dbo.FEEncabezado.MontoDescuentooRecargo18,
  dbo.FEEncabezado.MontoDescuentooRecargoOtraMoneda18,
  dbo.FEEncabezado.IndicadorFacturacionDescuentooRecargo18,
  dbo.FEEncabezado.NumeroLineaDoR19,
  dbo.FEEncabezado.TipoAjuste19,
  dbo.FEEncabezado.IndicadorNorma100719,
  dbo.FEEncabezado.DescripcionDescuentooRecargo19,
  dbo.FEEncabezado.TipoValor19,
  dbo.FEEncabezado.ValorDescuentooRecargo19,
  dbo.FEEncabezado.MontoDescuentooRecargo19,
  dbo.FEEncabezado.MontoDescuentooRecargoOtraMoneda19,
  dbo.FEEncabezado.IndicadorFacturacionDescuentooRecargo19,
  dbo.FEEncabezado.NumeroLineaDoR20,
  dbo.FEEncabezado.TipoAjuste20,
  dbo.FEEncabezado.IndicadorNorma100720,
  dbo.FEEncabezado.DescripcionDescuentooRecargo20,
  dbo.FEEncabezado.TipoValor20,
  dbo.FEEncabezado.ValorDescuentooRecargo20,
  dbo.FEEncabezado.MontoDescuentooRecargo20,
  dbo.FEEncabezado.MontoDescuentooRecargoOtraMoneda20,
  dbo.FEEncabezado.IndicadorFacturacionDescuentooRecargo20,
  dbo.FEEncabezado.NCFModificado,
  dbo.FEEncabezado.RNCOtroContribuyente,
  dbo.FEEncabezado.FechaNCFModificado,
  dbo.FEEncabezado.CodigoModificacion,
  dbo.FEEncabezado.RazonModificacion,
  dbo.FEEncabezado.IndicadorMontoGravadoI18,
  dbo.FEEncabezado.IndicadorMontoGravadoI16,
  dbo.FEEncabezado.IndicadorMontoGravadoI0,
  dbo.FEEncabezado.Tabla,
  dbo.FEEncabezado.campo1,
  dbo.FEEncabezado.campo2,
  CASE
    WHEN SUBSTRING(encf, 2, 2) = '32'
    AND MontoTotal < 250000 THEN CONCAT(
      'https://fc.dgii.gov.do',
      CASE
        WHEN LEN (TRIM(AI.ruta)) > 0 THEN CONCAT(TRIM(AI.ruta), '/')
        ELSE ''
      END,
      'ConsultaTimbreFC?RncEmisor=',
      TRIM(rncemisor),
      '&ENCF=',
      TRIM(encf),
      '&MontoTotal=',
      MontoTotal,
      '&CodigoSeguridad=',
      [dbo].[FNCambiaHexadecimal] (TRIM(CodigoSeguridad))
    )
    WHEN SUBSTRING(encf, 2, 2) = '47' THEN CONCAT(
      'https://ecf.dgii.gov.do',
      CASE
        WHEN LEN (TRIM(AI.ruta)) > 0 THEN CONCAT(TRIM(AI.ruta), '/')
        ELSE ''
      END,
      'ConsultaTimbre?RncEmisor=',
      TRIM(rncemisor),
      '&ENCF=',
      TRIM(encf),
      '&FechaEmision=',
      dbo.FNFechaDMY (FechaEmision),
      '&MontoTotal=',
      MontoTotal,
      '&FechaFirma=',
      REPLACE(TRIM(FechaFirma), ' ', '%20'),
      '&CodigoSeguridad=',
      [dbo].[FNCambiaHexadecimal] (CodigoSeguridad)
    )
    ELSE CONCAT(
      'https://ecf.dgii.gov.do',
      CASE
        WHEN LEN (TRIM(AI.ruta)) > 0 THEN CONCAT(TRIM(AI.ruta), '/')
        ELSE ''
      END,
      'ConsultaTimbre?RncEmisor=',
      TRIM(rncemisor),
      '&RncComprador=',
      REPLACE(TRIM(rnccomprador), '-', ''),
      --El origen del rnc cambia en cada cliente y base de datos
      '&ENCF=',
      TRIM(encf),
      '&FechaEmision=',
      dbo.FNFechaDMY (FechaEmision),
      '&MontoTotal=',
      MontoTotal,
      '&FechaFirma=',
      REPLACE(TRIM(FechaFirma), ' ', '%20'),
      '&CodigoSeguridad=',
      [dbo].[FNCambiaHexadecimal] (TRIM(CodigoSeguridad))
    )
  END AS URLQR
FROM
  dbo.FEEncabezado
  CROSS JOIN AmbienteInfo AS AI
